<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/Other/html.html to edit this template
-->
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <title>Configuracion</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"/>
        <!-- font awesome usado para iconos svg -->
        <link rel="stylesheet" th:href="@{/webjars/font-awesome/css/all.css}"/>

    </head>
    <body>
        <a th:href="@{/}">regresar</a>
        <!-- datos personales -->
        <h4>configuracion</h4>
        <hr/>
        <div>  
            <label>Edita datos personales</label>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalDatosPersonales">
                editar
            </button>
        </div>
        <div>

            <label>Edita contrasena</label>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalPassword">
                editar
            </button>

            <div th:if="${param.exito1}" class="alert alert-success d-flex" role="alert">
                <div class="text-center">
                    <i class="fa-solid fa-circle-check"></i>
                    Los datos personales se cambiaron exitosamente.
                </div>
            </div>
            <div th:if="${param.exito2}" class="alert alert-success d-flex" role="alert">
                <div class="text-center">
                    <i class="fa-solid fa-circle-check"></i>
                    La contrasena se cambio exitosamente.
                </div>
            </div>
            <div th:if="${param.error1}" class="alert alert-danger d-flex" role="alert">
                <div class="text-center">
                    <i class="fa-solid fa-xmark"></i>
                    Error. La contrasena actual no coincide con la digitada
                </div>
            </div>
            <div th:if="${param.error2}" class="alert alert-danger d-flex" role="alert">
                <div class="text-center">
                    <i class="fa-solid fa-xmark"></i>
                    Error. La contrasena nueva no es la misma que la contrasena de confirmacion
                </div>
            </div>
        </div>

        <!-- Modal editar datos personales -->
        <div class="modal fade" id="modalDatosPersonales" tabindex="-1" aria-labelledby="modalDatosPersonales" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form class="was-validated" method="POST" th:action="@{/modificarDatosPersonales}" th:object="${usuario}">
                            <div class="mb-3">
                                <input type="hidden" id="codigo" th:field="*{codigo}"/>
                                <input sec:authorize="hasRole('ROLE_USER')" type="hidden" 
                                       id="codigoAdministrador" th:field="*{codigoAdministrador.codigo}"/>
                                <input type="hidden" th:field="*{correo}"/>
                                <input type="hidden" th:field="*{contrasena}"/>


                                <label for="nombre" class="form-label">Nombre:</label>
                                <input type="text" class="form-control" id="nombre" th:field="*{nombre}" required="true"/>
                            </div>
                            <div class="mb-3" sec:authorize="hasRole('ROLE_ADMIN')">
                                <label for="negocio">Negocio:</label>
                                <input type="text" class="form-control" name="negocio" th:field="*{nombreNegocio}" required="true"/>
                            </div>
                            <div class="mb-3" sec:authorize="hasRole('ROLE_ADMIN')">
                                <label for="nit">Nit:</label>
                                <input type="number" class="form-control" name="nit" th:field="*{nitNegocio}" required="true"/>
                            </div>
                            <div class="mb-3" sec:authorize="hasRole('ROLE_ADMIN')">
                                <label for="direccion">Direccion:</label>
                                <input type="text" class="form-control" name="direccion" th:field="*{direccion}" required="true"/>
                            </div>
                            <div class="mb-3" sec:authorize="hasRole('ROLE_ADMIN')">
                                <label for="telefono">Telefono:</label>
                                <input type="tel" class="form-control" name="telefono" th:field="*{telefono}" required="true"/>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Guardar</button>
                            </div>
                        </form>
                    </div>


                </div>
            </div>
        </div>
        <!-- Modal editar password -->
        <div class="modal fade" id="modalPassword" tabindex="-1" aria-labelledby="modalCorreo" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form class="was-validated" method="POST" th:action="@{/modificarContrasena}" th:object="${usuario}">
                            <input type="hidden" id="codigo" th:field="*{codigo}"/>
                            <input type="hidden" id="correo" th:field="*{correo}"/>
                            <input type="hidden" id="contrasena" th:field="*{contrasena}"/>
                            <input type="hidden" id="nombre" th:field="*{nombre}"/>

                            <input sec:authorize="hasRole('ROLE_USER')" type="hidden" 
                                   id="codigoAdministrador" th:field="*{codigoAdministrador.codigo}"/>
                            <input sec:authorize="hasRole('ROLE_ADMIN')" type="hidden" 
                                   th:field="*{nombreNegocio}"/>
                            <input sec:authorize="hasRole('ROLE_ADMIN')" type="hidden" 
                                   th:field="*{nitNegocio}"/>
                            <input sec:authorize="hasRole('ROLE_ADMIN')" type="hidden" 
                                   th:field="*{direccion}"/>
                            <input sec:authorize="hasRole('ROLE_ADMIN')" type="hidden" 
                                   th:field="*{telefono}"/>
                            <div class="mb-3">
                                <label for="contrasenaActual" class="form-label">Contrasena actual:</label>
                                <input type="password" class="form-control" name="contrasenaActual"  required="true"/>
                            </div>
                            <div class="mb-3">
                                <label for="contrasenaNueva" class="form-label">Contrasena nueva:</label>
                                <input type="password" class="form-control" name="contrasenaNueva" required="true"/>
                            </div>
                            <div class="mb-3">
                                <label for="contrasenaConfirmacion" class="form-label">Confirmacion de contrasena:</label>
                                <input type="password" class="form-control" name="contrasenaConfirmacion" required="true"/>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Guardar</button>
                            </div>
                        </form>
                    </div>


                </div>
            </div>
        </div>

        <!-- js de bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    </body>
</html>
